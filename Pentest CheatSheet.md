# Pentest CheatSheet
Tags: #References #RTO #Cheatsheet \
Links:

These are useful commands that I found to be very effective during my pentests and CTFs. Please customize any command as needed for your scenario!

---

## Reconnaissance

### Port Scanning and Service Enumeration
'Default' TCP Nmap scan \
`nmap -sV -A -p- <ip>` 

'Default' UDP Nmap scan\
`nmap -sV -sU -F <ip>`

### Web Fuzzing & Directory Busting Enumeration
FFUF directory fuzzing (with proxychains) \
`proxychains -q ffuf -c -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u https://someurl.com/FUZZ` 

GoBuster Usage (with proxychains) \
`proxychains -q gobuster dir --url https://someurl.com --wordlist /path/to/wordlist`

### Domain Enumeration

DNSRecon local domain enumeration: \
`dnsrecon -r 127.0.0.1/24 -n <Ip_of_the_Victim_Website> -d <write_Something>`

### Subdomain Enumeration
Basic Amass Usage \
`amass enum -d <domain>`

Basic Subfinder Usage \
`subfinder -d <domain>`

FFUF Subdomain Enumeration \
`ffuf -c -w /usr/share/wordlists/amass/subdomains-top1mil-110000.txt -u https://FUZZ.someurl.com`

### SMB Enumeration

List shares with a null session \
`smbclient -L <IP>`

Connect to a share using a null session \
`smbclient -U '%' -N \\\\<IP>\\<SHARE>`

Script to enumerate SMB shares for null sessions (from Hacktricks)\
```
#/bin/bash

ip='<IP_ADDR>'
shares=('<SHARE1>' '<SHARE2>' '<SHARE3>')

for share in ${shares[*]}; do
    output=$(smbclient -U '%' -N \\\\$ip\\$share -c '') 

    if [[ -z $output ]]; then 
        echo "[+] creating a null session is possible for $share" # no output if command goes through, thus assuming that a session was created
    else
        echo $output # echo error message (e.g. NT_STATUS_ACCESS_DENIED or NT_STATUS_BAD_NETWORK_NAME)
    fi
done
```

### Github Repository Metadata
Open a browser and do: `https://api.github.com/repos/<owner>/<repository>`

## Initial Access

### Reverse Shell
Netcat Reverse Shell Listener \
`nc -nvlp 1234`

[Reverse Shell List](https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)

[Privilege Escalation + more](https://gtfobins.github.io/)

### Interactive Shell Spawner (to break free from a restrictive shell)
Python
```
--- Bash --- 

python3 -c 'import pty;pty.spawn("/bin/bash")'
python -c 'import pty;pty.spawn("/bin/bash")'

python3 -c 'import os; os.system("/bin/bash")'
python -c 'import os; os.system("/bin/bash")'

--- sh ---

python3 -c 'import pty;pty.spawn("/bin/sh")'
python -c 'import pty;pty.spawn("/bin/sh")'

python3 -c 'import os; os.system("/bin/sh")'
python -c 'import os; os.system("/bin/sh")'
```

### Linux Enumeration
SUID Enumeration
```
find / -user root -perm -4000 -print 2>/dev/null
find / -perm -u=s -type f 2>/dev/null
find / -user root -perm -4000 -exec ls -ldb {} \; 2>/dev/null
find / -perm +6000 2>/dev/null | grep '/bin/'
```

Show linux services and ports \
`netstat -punta` 

Show all services \
`systemctl`

Capabilities Enumeration \
`getcap -r / 2>/dev/null`

Hardcoded Credentials Enumeration (Modify as necessary) \
`grep -lir "password" .`

**User Enumeration**
```
List usernames: 
	awk -F: '{ print $1}' /etc/passwd
	cut -d: -f1 /etc/passwd

List normal users: 
	getent passwd{1000..60000}

List everything:
	cat /etc/passwd
	
```

Sudo Privileges \
`sudo -l`

User Count \
`getent passwd | wc -l`

System Enumeration \
`cat /etc/os-release`

## Useful Metasploit Modules (Misc)
```
Reverse Shell Handler
	exploit/multi/handler

Reverse Shell
	windows/meterpreter/reverse_tcp

Post Exploitation
	post/multi/recon/local_exploit_suggester
	post/windows/gather/checkvm
	post/windows/manage/enable_rdp
	
	Persistence & Backdoor
	exploit/linux/local/cron_persistence
	exploit/windows/local/persistence

Login & Bruteforcer
	auxiliary/scanner/ssh/ssh_login
	auxiliary/scanner/ftp/ftp_login 
```

## Useful Meterpreter Modules
```
Meterpreter Backdoor Service
	run metsvc (to catch this backdoor, one must use PAYLOAD windows/metsvc_bind_tcp at the handler)

Persistent Backdoor
	run persistence -h
```

## Search Exploits in "Searchsploit"

To update the DB:
```
searchsploit -u
```

To search:
```
searchsploit <string>
```
